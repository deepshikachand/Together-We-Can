(()=>{var e={};e.id=8301,e.ids=[8301],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},94264:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>m,serverHooks:()=>g,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>f});var s=r(42706),i=r(28203),n=r(45994),o=r(96330),c=r(39187),u=r(51825),d=r(37702);let l=new o.PrismaClient;async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("cityId"),a=t.get("categoryId"),s=t.get("sortBy")||"date",i=t.get("top"),n=new Date,o={},u=e=>!e||""===e.trim()||"all"===e.trim().toLowerCase()||"all cities"===e.trim().toLowerCase()||"all categories"===e.trim().toLowerCase();if(!u(r)){if(r&&/^[a-f\d]{24}$/i.test(r))o.cityId=r;else if(r){let[e,t]=r.split(",").map(e=>e.trim()),a=await l.city.findFirst({where:{cityName:e,...t?{state:t}:{}}});a&&(o.cityId=a.id)}}if(!u(a)){if(a&&/^[a-f\d]{24}$/i.test(a))o.categoryIds={has:a};else if(a){let e=await l.category.findFirst({where:{categoryName:a}});e&&(o.categoryIds={has:e.id})}}if(o={...o,OR:[{endDate:{gte:n}},{AND:[{endDate:null},{startDate:{gte:n}}]}],status:{not:"completed"}},i){let e=parseInt(i);if(!isNaN(e)){let t=await l.event.findMany({take:e,orderBy:{currentParticipants:"desc"},where:o,include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}}});return c.NextResponse.json(t)}}let d=await l.event.findMany({where:o,include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}},orderBy:{startDate:"asc"}}),p=(d=d.filter(e=>{let t=Math.max(Math.ceil(e.expectedParticipants/3),10);return e.currentParticipants>=t})).map(async e=>{let t=!1,r=e.status,a=e.statusReason,s=e.postponedUntil,i=Math.max(Math.ceil(e.expectedParticipants/3),10),o=e.endDate||e.startDate;return(new Date(o)<n&&e.currentParticipants<i&&"not_completed"!==e.status&&"cancelled"!==e.status&&(r="not_completed",a="Event did not meet the minimum participant requirement and was not completed.",t=!0),new Date(o)<n&&"completed"!==e.status&&"cancelled"!==e.status?(r="completed",a="Automatically completed as end date passed.",t=!0,console.log(`Auto-completing event ${e.id} (${e.eventName}) as its end date (${o}) is before now (${n.toISOString()})`)):"postponed"===e.status&&e.postponedUntil&&new Date(e.postponedUntil)<n?(r="upcoming",a="Automatically resumed after postponement period.",s=null,t=!0):"upcoming"===e.status&&new Date(e.startDate)<=n&&(!e.endDate||new Date(e.endDate)>=n)?(r="active",a="Automatically set to active as start date has passed.",t=!0):"active"===e.status&&o&&new Date(o)<n&&(r="completed",a="Automatically completed as end date passed while active.",t=!0,console.log(`Auto-completing active event ${e.id} (${e.eventName}) as its end date (${o}) is before now (${n.toISOString()})`)),t)?await l.event.update({where:{id:e.id},data:{status:r,statusReason:a,statusUpdatedAt:n,postponedUntil:s},include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}}}):await l.event.findUnique({where:{id:e.id},include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}}})});return d=(d=(await Promise.all(p)).filter(e=>null!==e)).filter(e=>null!==e.city),"date"===s?d=d.sort((e,t)=>new Date(e.startDate).getTime()-new Date(t.startDate).getTime()):"participants"===s&&(d=d.sort((e,t)=>t.currentParticipants-e.currentParticipants)),c.NextResponse.json(d||[])}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return console.error("Error fetching events:",e),c.NextResponse.json({error:"Error fetching events",message:e},{status:500})}}async function f(e){try{let t=await (0,u.getServerSession)(d.N);if(!t?.user?.id)return c.NextResponse.json({message:"You must be signed in to create an event"},{status:401});let{eventName:r,description:a,startDate:s,endDate:i,time:n,location:o,fullAddress:p,latitude:f,longitude:m,cityId:w,categoryId:y,expectedParticipants:g}=await e.json();if(!r||!a||!s||!n||!o||!w||!y||!g)return c.NextResponse.json({message:"Missing required fields"},{status:400});let v=await l.event.create({data:{eventName:r,description:a,startDate:new Date(s),endDate:i?new Date(i):void 0,time:n,location:o,fullAddress:p,latitude:f,longitude:m,cityId:w,categoryIds:[y],expectedParticipants:parseInt(g),currentParticipants:0,status:"upcoming",creatorId:t.user.id,createdAt:new Date,updatedAt:new Date}});return c.NextResponse.json(v)}catch(e){return console.error("Error creating event:",e),c.NextResponse.json({message:"Error creating event"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"E:\\Deepshika\\web development\\Together-We-Can-main\\src\\app\\api\\events\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:y,serverHooks:g}=m;function v(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:y})}},96487:()=>{},78335:()=>{},13676:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},51825:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var s=r(13676);Object.keys(s).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))});var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(void 0);if(r&&r.has(e))return r.get(e);var a={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&({}).hasOwnProperty.call(e,i)){var o=s?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}(r(64767));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))})},37702:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var a=r(46814),s=r(96330),i=r(58964),n=r.n(i),o=r(91642);let c=new s.PrismaClient,u={adapter:(0,a.y)(c),providers:[(0,o.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Invalid credentials");let t=await c.user.findUnique({where:{email:e.email}});if(!t||!t?.password)throw Error("Invalid credentials");if(!t.emailVerified)throw Error("Please verify your email address before signing in. Check your inbox for a verification link.");if(!await n().compare(e.password,t.password))throw Error("Invalid credentials");return t}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t.id),e)},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,debug:!1,pages:{signIn:"/auth/signin"}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,5452,8964,5229],()=>r(94264));module.exports=a})();