(()=>{var e={};e.id=8301,e.ids=[8301],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},94264:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>f});var s=r(42706),n=r(28203),i=r(45994),o=r(96330),u=r(39187),c=r(51825),l=r(37702);let d=new o.PrismaClient;async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("cityId"),a=t.get("categoryId"),s=t.get("sortBy")||"date",n=t.get("top"),i=new Date,o={},c=e=>!e||""===e.trim()||"all"===e.trim().toLowerCase()||"all cities"===e.trim().toLowerCase()||"all categories"===e.trim().toLowerCase();if(!c(r)){if(r&&/^[a-f\d]{24}$/i.test(r))o.cityId=r;else if(r){let[e,t]=r.split(",").map(e=>e.trim()),a=await d.city.findFirst({where:{cityName:e,...t?{state:t}:{}}});a&&(o.cityId=a.id)}}if(!c(a)){if(a&&/^[a-f\d]{24}$/i.test(a))o.categoryIds={has:a};else if(a){let e=await d.category.findFirst({where:{categoryName:a}});e&&(o.categoryIds={has:e.id})}}if(o={...o,OR:[{endDate:{gte:i}},{AND:[{endDate:null},{startDate:{gte:i}}]}],status:{not:"completed"}},n){let e=parseInt(n);if(!isNaN(e)){let t=await d.event.findMany({take:e,orderBy:{currentParticipants:"desc"},where:o,include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}}});return u.NextResponse.json(t)}}let l=await d.event.findMany({where:o,include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}},orderBy:{startDate:"asc"}}),p=(l=l.filter(e=>{let t=Math.max(Math.ceil(e.expectedParticipants/3),10);return e.currentParticipants>=t})).map(async e=>{let t=!1,r=e.status,a=e.statusReason,s=e.postponedUntil,n=Math.max(Math.ceil(e.expectedParticipants/3),10),o=e.endDate||e.startDate;return(new Date(o)<i&&e.currentParticipants<n&&"not_completed"!==e.status&&"cancelled"!==e.status&&(r="not_completed",a="Event did not meet the minimum participant requirement and was not completed.",t=!0),new Date(o)<i&&"completed"!==e.status&&"cancelled"!==e.status?(r="completed",a="Automatically completed as end date passed.",t=!0,console.log(`Auto-completing event ${e.id} (${e.eventName}) as its end date (${o}) is before now (${i.toISOString()})`)):"postponed"===e.status&&e.postponedUntil&&new Date(e.postponedUntil)<i?(r="upcoming",a="Automatically resumed after postponement period.",s=null,t=!0):"upcoming"===e.status&&new Date(e.startDate)<=i&&(!e.endDate||new Date(e.endDate)>=i)?(r="active",a="Automatically set to active as start date has passed.",t=!0):"active"===e.status&&o&&new Date(o)<i&&(r="completed",a="Automatically completed as end date passed while active.",t=!0,console.log(`Auto-completing active event ${e.id} (${e.eventName}) as its end date (${o}) is before now (${i.toISOString()})`)),t)?await d.event.update({where:{id:e.id},data:{status:r,statusReason:a,statusUpdatedAt:i,postponedUntil:s},include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}}}):await d.event.findUnique({where:{id:e.id},include:{city:!0,categories:!0,creator:{select:{id:!0,name:!0}}}})});return l=(l=(await Promise.all(p)).filter(e=>null!==e)).filter(e=>null!==e.city),"date"===s?l=l.sort((e,t)=>new Date(e.startDate).getTime()-new Date(t.startDate).getTime()):"participants"===s&&(l=l.sort((e,t)=>t.currentParticipants-e.currentParticipants)),u.NextResponse.json(l||[])}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return console.error("Error fetching events:",e),u.NextResponse.json({error:"Error fetching events",message:e},{status:500})}}async function f(e){try{let t=await (0,c.getServerSession)(l.N);if(!t?.user?.id)return u.NextResponse.json({message:"You must be signed in to create an event"},{status:401});let{eventName:r,description:a,startDate:s,endDate:n,time:i,location:o,fullAddress:p,latitude:f,longitude:m,cityId:y,categoryId:g,expectedParticipants:w}=await e.json();if(!r||!a||!s||!i||!o||!y||!g||!w)return u.NextResponse.json({message:"Missing required fields"},{status:400});let v=await d.event.create({data:{eventName:r,description:a,startDate:new Date(s),endDate:n?new Date(n):void 0,time:i,location:o,fullAddress:p,latitude:f,longitude:m,cityId:y,categoryIds:[g],expectedParticipants:parseInt(w),currentParticipants:0,status:"upcoming",creatorId:t.user.id,createdAt:new Date,updatedAt:new Date}});return u.NextResponse.json(v)}catch(e){return console.error("Error creating event:",e),u.NextResponse.json({message:"Error creating event"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"E:\\Deepshika\\web development\\Together-We-Can-main\\src\\app\\api\\events\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:y,workUnitAsyncStorage:g,serverHooks:w}=m;function v(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:g})}},96487:()=>{},78335:()=>{},13676:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},51825:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n.default}});var s=r(13676);Object.keys(s).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))});var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(void 0);if(r&&r.has(e))return r.get(e);var a={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&({}).hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(a,n,o):a[n]=e[n]}return a.default=e,r&&r.set(e,a),a}(r(64767));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))})},37301:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(void 0);if(r&&r.has(e))return r.get(e);var a={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}(r(76301));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}let n={current:null},i="function"==typeof a.cache?a.cache:e=>e,o=console.warn;function u(e){return function(...t){o(e(...t))}}i(e=>{try{o(n.current)}finally{n.current=null}})},37702:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var a=r(46814),s=r(84908),n=r(58964),i=r.n(n),o=r(91642);let u={adapter:(0,a.y)(s.z),providers:[(0,o.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Invalid credentials");let t=await s.z.user.findUnique({where:{email:e.email}});if(!t||!t.password)throw Error("Invalid credentials");if(!t.emailVerified)throw Error("Please verify your email before signing in.");if(!await i().compare(e.password,t.password))throw Error("Invalid credentials");return t}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t.id),e)},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,debug:!1,pages:{signIn:"/user-auth/signin",signOut:"/user-auth/signout"}}},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var a=r(96330);let s=globalThis.prisma||new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,5452,8964,5229],()=>r(94264));module.exports=a})();